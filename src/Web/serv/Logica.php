<?php
//-----------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------//
//                 										  LOGICA.PHP															   //
//-----------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------//
// Adrián Tur Rubio
// Proyecto Aplicaciones de Biometria y Medio Ambiente - Parte Web
// Curso 2022-2023
//-----------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------//
// Descripción: El archivo logica.php representa la parte de la lógica de la aplicación.
//-----------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------//

include './LogicaBBDD.php';

//-----------------------------------------------------------------------------------------------------------------------------//
//--------------------------------------------------------GUARDARMEDICION()----------------------------------------------------//
//
// tiempo <long>,sensor <String>,valor <double> --> guardarMedicion() --> String
//
//-----------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------//
function guardarMedicion($Tiempo,$Sensor,$valor)
{
    //llamamos a la funcion guardarBBDD() de logicabbdd.php
    if (guardarBBDD($Tiempo,$Sensor,$valor)) {
        echo "Medicion guardada en BBDD";
    } else {
        //si hay algún error devuelve 401
        http_response_code(401);
        die();
    }
}
//-----------------------------------------------------------------------------------------------------------------------------//
//--------------------------------------------------------RECIBIRMEDICION()----------------------------------------------------//
//
// sensor <String> --> recibirMediciones() --> JSON
//
//-----------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------//
function recibirMediciones($tipo)
{
    //llamamos a la funcion recibirBBDD() de logicabbdd.php
    $Mediciones = recibirBBDD($tipo);
    $resultado = array();
    $i = 0;

    //creamos lista JSON
    while ($fila = mysqli_fetch_array($Mediciones)) {
        $respuesta = [];
        $respuesta["Tiempo"] = $fila ["Tiempo"];
        $respuesta["Sensor"] = $fila ["Sensor"];
        $respuesta["valor"] = $fila ["valor"];
        $resultado[$i] = $respuesta;
        $i++;
    }

    //devolvemos la lista como json
    echo json_encode($resultado);
}



