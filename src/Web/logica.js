//-----------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------//
//                 											LOGICA															   //
//-----------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------//
// Adrián Tur Rubio
// Proyecto Aplicaciones de Biometria y Medio Ambiente - Parte Web
// Curso 2022-2023
//-----------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------//
// Descripción: El archivo logica.js representa la parte de la lógica fake de la aplicación.
//-----------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------//
//----------------------------------------------------PETICIONSERVIDOR()-------------------------------------------------------//
//
//	--> peticionServidor() -->
//
//-----------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------//
function peticionServidor() {
    console.log("entra en peticionServidor()")//comprobamos que entra a esta función

    //Realizamos un fetch para la peticion del servidor con método GET.
    fetch("./serv/apiREST.php?sensor=o2", {
        method: "GET"
    }).then(function (result) {
        //si la peticion se realiza correctamente se recibe un JSON con los datos
        if (result.ok) {
            return result.json();
        }
    }).then(function (datos) {
        //Muestro los datos en la consola
        /*for (let i = 0; i < datos.length; i++) {
            console.log(datos[i].Tiempo)
            console.log(datos[i].Sensor)
            console.log(datos[i].valor)
        }*/
        //Muestro los datos en una tabla
        mostrarTabla(datos);
    })
}

//-----------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------//
//-------------------------------------------------------MOSTRARTABLA()--------------------------------------------------------//
//
//	Objeto[JSON] --> mostrarTabla() -->
//
//-----------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------//
function mostrarTabla(datos) {

    let tableBody = document.getElementById('tbody'); //asigno el id tbody y  creo la tabla para mostrarla
    tableBody.innerHTML = ""; //borro los elementos que hay en la tabla previamente

    //Inserto por cada medicion una fila a la tabla
    for (let i = 0; i < datos.length; i++) {
        let varTiempo = "<td>" + pasarSegundos(datos[i].Tiempo) + "</td>";
        let varSensor = "<td>" + datos[i].Sensor + "</td>";
        let varvalor = "<td>" + datos[i].valor + "</td>";
        tableBody.innerHTML += varTiempo + varSensor + varvalor;
    }
}

//-----------------------------------------------------------------------------------------------------------------------------//
//-------------------------------------------------------PASARSEGUNDOS()-------------------------------------------------------//
//
//	Long --> mostrarSegundos() --> String
//
//-----------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------//
function pasarSegundos(segundos){
    var date = new Date(parseInt(segundos));
    var fecha=date.getDate()+"/"+(date.getMonth()+1)+"/"+date.getFullYear()+" "+date.getHours()+":"+date.getMinutes()+":"+date.getSeconds()
    return fecha;
}
//-----------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------//